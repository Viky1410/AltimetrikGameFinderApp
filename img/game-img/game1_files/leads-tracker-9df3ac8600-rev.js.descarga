define(["jquery","version!fly/managers/debug","managers/tealium","managers/page-vars","version!fly/components/base"],function(e,t,a,c){t=t.init("leadsTracker"),e.widget("cnet.leadsTracker",e.fly.base,{options:{appendViewguid:!0,fireTrackingPing:!0,numNodes:3,trackingData:{},dwLinktag:null,leadsTrackerSelector:"a[data-component=leadsTracker]"},viewguid:null,commerceClickPlaceholder:"___COM_CLICK_ID___",_create:function(){this._setup(),this.viewguid=c.guid,this.options.appendViewguid&&this.viewguid&&(this.$element.attr("href",this.$element.attr("href").replace("___VIEW_GUID___",this.viewguid)),this.options.trackingData.destUrl=this.options.trackingData.destUrl.replace("___VIEW_GUID___",this.viewguid)),this.options.fireTrackingPing&&this._setupEvents(),window.leadsTracker=!0},_setupEvents:function(){var i=this;this.$element.on("mousedown",function(r){if(0==r.button||1==r.button||2==r.button)try{var l=i.options.trackingData?i.options.trackingData:i.options,n=e(this).parent()[0].classList.value;i._setCommerceClickId(),c.tracking.data.commerceClickId&&(e(this).attr("href",e(this).attr("href").replace(i.commerceClickPlaceholder,c.tracking.data.commerceClickId.replaceAll("-",""))),l.destUrl=l.destUrl.replace(i.commerceClickPlaceholder,c.tracking.data.commerceClickId.replaceAll("-","")));var d={_topicPrimaryId:l.topic?l.topic:"",articleType:c.tracking.data.articleType?c.tracking.data.articleType:"deal",articleId:l.articleId?l.articleId:l.assetguid,_campaign:l.ttag?"ttag:"+l.ttag:null,commerceClickId:c.tracking.data.commerceClickId?c.tracking.data.commerceClickId:"",_leadcpc:l.leadcpc,dwLinkTag:l.dwLinkTag||a.getDwTag(e(r.target),i.options.numNodes),eventTarget:(n?"."+n.replaceAll(" ",".")+" ":"")+i.options.leadsTrackerSelector,eventObject:r},o=e.extend(d,l);a.trackLead(o),setTimeout(e.proxy(function(){c.tracking.data.commerceClickId&&(e(this).attr("href",e(this).attr("href").replace(c.tracking.data.commerceClickId.replaceAll("-",""),i.commerceClickPlaceholder)),l.destUrl=l.destUrl.replace(c.tracking.data.commerceClickId.replaceAll("-",""),i.commerceClickPlaceholder))},this),500)}catch(e){t.log("Unable to parse tracking url",e)}})},_setCommerceClickId:function(){var e=window.uuid();utag_data.commerceClickId=e,c.tracking.data.commerceClickId=e}})});